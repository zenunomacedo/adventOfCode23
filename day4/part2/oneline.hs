main = readFile "input.txt" >>= print . fst . foldl (\(v, l) (i,w) -> (v + 1 + (sum $ map ((\(Just x) -> x) . flip lookup l) $ take w [i+1, i+2..]), (i,1 + (sum $ map ((\(Just x) -> x) . flip lookup l) $ take w [i+1, i+2..])):l)) (0, []) . reverse . map ((\(iden, ':':s') -> (\(win, '|':ours) -> (read iden, length $ filter (`elem` (words win)) (words ours))) $ span (/= '|') s' ) . span (/= ':') . drop 5) . lines     